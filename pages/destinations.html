<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brazilian Destinations - Brazil Travel Planner</title>    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>      /* Dynamic Mapbox Popup Styling */
      .mapboxgl-popup {
        max-width: none !important;
        z-index: 1000 !important;
      }
      
      .mapboxgl-popup-content {
        padding: 0 !important;
        border-radius: 12px !important;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        border: 1px solid #e0e0e0 !important;
        max-height: 80vh !important;
        overflow-y: auto !important;
        width: auto !important;
        min-width: 280px !important;
      }
      
      .mapboxgl-popup-close-button {
        background: rgba(0,0,0,0.5) !important;
        color: white !important;
        border-radius: 50% !important;
        width: 24px !important;
        height: 24px !important;
        font-size: 16px !important;
        line-height: 22px !important;
        text-align: center !important;
        top: 8px !important;
        right: 8px !important;
        z-index: 1001 !important;
      }
      
      .mapboxgl-popup-tip {
        border-top-color: #e0e0e0 !important;
      }
      
      /* Responsive popup sizing */
      @media (max-width: 768px) {
        .mapboxgl-popup-content {
          max-width: calc(100vw - 40px) !important;
          min-width: 250px !important;
          max-height: 70vh !important;
        }
      }
      
      @media (max-width: 480px) {
        .mapboxgl-popup-content {
          max-width: calc(100vw - 20px) !important;
          min-width: 240px !important;
          max-height: 60vh !important;
        }
      }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-map-marked-alt me-2"></i>
                Brazil Travel Planner
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="destinations.html">Destinations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="planner.html">Planner</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1>Brazilian Destinations</h1>
                <p class="lead">Discover amazing places across Brazil</p>
                <!-- Mapbox Map Integration -->
                <div id="map" style="width: 100%; height: 400px; border-radius: 12px; margin-bottom: 2rem;"></div>
                <!-- End Mapbox Map -->                <!-- Placeholder for destination cards -->
                <div class="row" id="destinationsContainer">
                  <!-- Destination cards will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="bottom-nav d-lg-none">
        <a href="../index.html" class="bottom-nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="destinations.html" class="bottom-nav-item active">
            <i class="fas fa-map-marker-alt"></i>
            <span>Destinations</span>
        </a>
        <a href="planner.html" class="bottom-nav-item">
            <i class="fas fa-calendar"></i>
            <span>Planner</span>
        </a>
        <a href="about.html" class="bottom-nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>    <script src="../assets/js/modules/config.js"></script>
    <script src="../assets/js/modules/utils.js"></script>
    <script src="../assets/js/modules/weather.js"></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    
    <!-- Custom popup styles for responsive design -->
    <style>
      .custom-popup .mapboxgl-popup-content {
        padding: 15px !important;
        border-radius: 8px !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        max-width: 320px !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
      }
      
      .custom-popup .mapboxgl-popup-tip {
        border-top-color: #ffffff !important;
        border-bottom-color: #ffffff !important;
      }
      
      /* Mobile responsive adjustments */
      @media (max-width: 768px) {
        .custom-popup .mapboxgl-popup-content {
          max-width: 280px !important;
          padding: 12px !important;
          font-size: 13px !important;
        }
        
        .custom-popup h5 {
          font-size: 14px !important;
        }
        
        .custom-popup button {
          padding: 8px 12px !important;
          font-size: 12px !important;
        }
      }
      
      /* Ensure popup stays within map bounds */
      .mapboxgl-popup {
        max-width: calc(100vw - 40px) !important;
      }
      
      .mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
        border-top-color: #ffffff !important;
      }
      
      .mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
        border-bottom-color: #ffffff !important;
      }
      
      .mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
        border-right-color: #ffffff !important;
      }
      
      .mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
        border-left-color: #ffffff !important;
      }
    </style>
    
    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoiaW50ZXJuaWNrMjAxNyIsImEiOiJjbWJ1Nnk2aWgwYnQ5MmxweDAwMTVlM20xIn0.-ACRXNq9akIVkBCzU2Gz-w';
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-47.9292, -15.7801], // Center on Brazil
        zoom: 3.5
      });      map.addControl(new mapboxgl.NavigationControl());
        // Function to get responsive popup configuration
      function getResponsivePopupConfig() {
        const mapContainer = map.getContainer();
        const mapWidth = mapContainer.offsetWidth;
        const mapHeight = mapContainer.offsetHeight;
        const isMobile = window.innerWidth <= 768;
        
        return {
          // Remove fixed anchor to allow auto-positioning
          // This lets Mapbox automatically choose the best position to avoid cutoffs
          offset: isMobile ? 15 : 25, // Smaller offset on mobile
          closeButton: true,
          closeOnClick: false,
          className: 'custom-popup',
          focusAfterOpen: false, // Prevent mobile focus issues
          maxWidth: isMobile ? '280px' : '320px'
        };
      }
      
      // Initialize Weather API
      const weatherAPI = new WeatherAPI();
      let markersWithWeather = [];
      
      // Function to get weather icon based on condition
      function getWeatherIcon(condition) {
        const icons = {
          'Clear': '‚òÄÔ∏è',
          'Sunny': '‚òÄÔ∏è', 
          'Rain': 'üåßÔ∏è',
          'Cloudy': '‚òÅÔ∏è',
          'Overcast': '‚òÅÔ∏è',
          'Partially cloudy': '‚õÖ',
          'default': 'üå§Ô∏è'
        };
        return icons[condition] || icons.default;
      }
      
      // Function to get temperature color
      function getTempColor(temp) {
        if (temp >= 30) return '#FF6B6B'; // Hot - Red
        if (temp >= 25) return '#FFD93D'; // Warm - Yellow  
        if (temp >= 20) return '#6BCF7F'; // Mild - Green
        return '#74C0FC'; // Cool - Blue
      }
      
      // Enhanced destination data with travel information
      const destinations = [
        { 
          name: 'Rio de Janeiro', 
          coords: [-43.1729, -22.9068],
          description: 'Famous for Christ the Redeemer, Copacabana Beach, and vibrant culture',
          highlights: ['Christ the Redeemer', 'Copacabana Beach', 'Sugarloaf Mountain', 'Carnival'],
          bestTime: 'Dec-Mar (Summer)',
          avgTemp: '25¬∞C',
          category: 'Beach & Culture'
        },
        { 
          name: 'S√£o Paulo', 
          coords: [-46.6333, -23.5505],
          description: 'Brazil\'s largest city with amazing food, art, and nightlife',
          highlights: ['Art Museums', 'Food Scene', 'Vila Madalena', 'Japanese District'],
          bestTime: 'Apr-Oct (Dry season)',
          avgTemp: '20¬∞C',
          category: 'Urban & Culture'
        },
        { 
          name: 'Bras√≠lia', 
          coords: [-47.9292, -15.7801],
          description: 'Modern capital with unique architecture and government buildings',
          highlights: ['Cathedral', 'National Congress', 'JK Bridge', 'City Park'],
          bestTime: 'May-Sep (Dry season)',
          avgTemp: '21¬∞C',
          category: 'Architecture & Politics'
        },
        { 
          name: 'Salvador', 
          coords: [-38.5014, -12.9730],
          description: 'Historic colonial city with Afro-Brazilian culture and beautiful beaches',
          highlights: ['Pelourinho', 'Historic Center', 'Beaches', 'Capoeira'],
          bestTime: 'Dec-Mar (Summer)',
          avgTemp: '27¬∞C',
          category: 'History & Beach'
        },
        { 
          name: 'Manaus', 
          coords: [-60.0258, -3.1190],
          description: 'Gateway to the Amazon rainforest with unique wildlife and river tours',
          highlights: ['Meeting of Waters', 'Amazon Tours', 'Opera House', 'Jungle Lodge'],
          bestTime: 'Jul-Nov (Dry season)',
          avgTemp: '28¬∞C',
          category: 'Nature & Adventure'
        },
        { 
          name: 'Florian√≥polis', 
          coords: [-48.5482, -27.5969],
          description: 'Island paradise with 42 beaches and tech innovation hub',
          highlights: ['Joaquina Beach', 'Lagoa da Concei√ß√£o', 'Surfing', 'Sand Dunes'],
          bestTime: 'Dec-Mar (Summer)',
          avgTemp: '24¬∞C',
          category: 'Beach & Technology'
        },
        { 
          name: 'Foz do Igua√ßu', 
          coords: [-54.5854, -25.5163],
          description: 'Home to spectacular Iguazu Falls, one of the world\'s largest waterfalls',
          highlights: ['Iguazu Falls', 'Bird Park', 'Triple Border', 'Itaipu Dam'],
          bestTime: 'Mar-May, Sep-Nov',
          avgTemp: '21¬∞C',
          category: 'Nature & Adventure'
        }
      ];

      // Create enhanced markers with detailed popups and weather overlay
      async function createMarkersWithWeather() {
        for (const dest of destinations) {
          try {
            // Fetch current weather for each destination
            const weatherData = await weatherAPI.getCurrentWeather(`${dest.name},Brazil`, 'metric');
            const currentWeather = weatherData.currentConditions;
            const temp = Math.round(currentWeather.temp);
            const condition = currentWeather.conditions;
            const icon = getWeatherIcon(condition);
            
            // Create custom marker with weather overlay
            const markerElement = document.createElement('div');
            markerElement.className = 'custom-marker-weather';
            markerElement.innerHTML = `
              <div style="position: relative;">
                <div style="
                  background-color: ${getTempColor(temp)};
                  width: 24px;
                  height: 24px;
                  border-radius: 50%;
                  border: 2px solid white;
                  cursor: pointer;
                  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 10px;
                  font-weight: bold;
                  color: white;
                ">
                  ${temp}¬∞
                </div>
                <div style="
                  position: absolute;
                  top: -8px;
                  right: -8px;
                  font-size: 12px;
                  filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.5));
                ">
                  ${icon}
                </div>
              </div>
            `;            // Enhanced popup content with live weather - Fixed styling
            const popupContent = `
              <div style="width: 280px; min-height: 200px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.4;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                  <h5 style="margin: 0; color: #007BFF; font-size: 18px; font-weight: 600; flex: 1;">${dest.name}</h5>
                  <div style="text-align: right; margin-left: 10px; flex-shrink: 0;">
                    <div style="font-size: 20px; margin-bottom: 2px;">${icon} ${temp}¬∞C</div>
                    <div style="font-size: 11px; color: #666; white-space: nowrap;">${condition}</div>
                  </div>
                </div>
                
                <p style="margin: 0 0 12px 0; font-size: 13px; color: #555; line-height: 1.4;">${dest.description}</p>
                
                <div style="margin-bottom: 10px;">
                  <span style="background: #e7f3ff; color: #0066cc; padding: 3px 8px; border-radius: 15px; font-size: 11px; font-weight: 500;">${dest.category}</span>
                </div>
                
                <div style="margin-bottom: 12px; padding: 8px; background: #f8f9fa; border-radius: 6px;">
                  <div style="margin-bottom: 4px;">
                    <strong style="font-size: 12px; color: #333;">üå§Ô∏è Current:</strong> 
                    <span style="font-size: 12px; color: #007BFF;">${temp}¬∞C, ${condition}</span>
                  </div>
                  <div>
                    <strong style="font-size: 12px; color: #333;">üìÖ Best Time:</strong> 
                    <span style="font-size: 12px;">${dest.bestTime}</span>
                  </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                  <strong style="font-size: 12px; color: #333; display: block; margin-bottom: 6px;">‚ú® Top Highlights:</strong>
                  <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    ${dest.highlights.map(h => `<span style="background: #fff3cd; color: #856404; padding: 2px 6px; border-radius: 10px; font-size: 10px;">${h}</span>`).join('')}
                  </div>
                </div>
                
                <button onclick="addToPlanner('${dest.name}')" 
                        style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; 
                               padding: 10px 16px; border-radius: 6px; font-size: 13px; font-weight: 500; 
                               cursor: pointer; width: 100%; transition: all 0.2s; box-shadow: 0 2px 4px rgba(40,167,69,0.2);"
                        onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(40,167,69,0.3)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(40,167,69,0.2)'">
                  <i class="fas fa-plus"></i> Add to My Planner
                </button>              </div>
            `;            // Create popup with responsive positioning
            const popupConfig = getResponsivePopupConfig();
            const popup = new mapboxgl.Popup(popupConfig)
            .setHTML(popupContent)
            .setMaxWidth(popupConfig.maxWidth);

            const marker = new mapboxgl.Marker(markerElement)
              .setLngLat(dest.coords)
              .setPopup(popup)
              .addTo(map);
              
            markersWithWeather.push({marker, dest, weather: currentWeather});
            
          } catch (error) {
            console.warn(`Could not fetch weather for ${dest.name}:`, error);
            // Fallback to basic marker without weather
            const markerElement = document.createElement('div');
            markerElement.className = 'custom-marker';
            markerElement.style.cssText = `
              background-color: #007BFF;
              width: 20px;
              height: 20px;
              border-radius: 50%;
              border: 2px solid white;
              cursor: pointer;
              box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            `;            const popupContent = `
              <div style="width: 280px; min-height: 180px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.4;">
                <h5 style="margin: 0 0 10px 0; color: #007BFF; font-size: 18px; font-weight: 600;">${dest.name}</h5>
                <p style="margin: 0 0 12px 0; font-size: 13px; color: #555; line-height: 1.4;">${dest.description}</p>
                
                <div style="margin-bottom: 10px;">
                  <span style="background: #e7f3ff; color: #0066cc; padding: 3px 8px; border-radius: 15px; font-size: 11px; font-weight: 500;">${dest.category}</span>
                </div>
                
                <div style="margin-bottom: 12px; padding: 8px; background: #f8f9fa; border-radius: 6px;">
                  <div style="margin-bottom: 4px;">
                    <strong style="font-size: 12px; color: #333;">üå°Ô∏è Avg Temp:</strong> 
                    <span style="font-size: 12px;">${dest.avgTemp}</span>
                  </div>
                  <div>
                    <strong style="font-size: 12px; color: #333;">üìÖ Best Time:</strong> 
                    <span style="font-size: 12px;">${dest.bestTime}</span>
                  </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                  <strong style="font-size: 12px; color: #333; display: block; margin-bottom: 6px;">‚ú® Top Highlights:</strong>
                  <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    ${dest.highlights.map(h => `<span style="background: #fff3cd; color: #856404; padding: 2px 6px; border-radius: 10px; font-size: 10px;">${h}</span>`).join('')}
                  </div>
                </div>
                
                <button onclick="addToPlanner('${dest.name}')" 
                        style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; 
                               padding: 10px 16px; border-radius: 6px; font-size: 13px; font-weight: 500; 
                               cursor: pointer; width: 100%; transition: all 0.2s; box-shadow: 0 2px 4px rgba(40,167,69,0.2);"
                        onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(40,167,69,0.3)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(40,167,69,0.2)'">
                  <i class="fas fa-plus"></i> Add to My Planner
                </button>              </div>
            `;            // Create fallback popup with responsive positioning
            const fallbackPopupConfig = getResponsivePopupConfig();
            const fallbackPopup = new mapboxgl.Popup(fallbackPopupConfig)
            .setHTML(popupContent)
            .setMaxWidth(fallbackPopupConfig.maxWidth);

            const marker = new mapboxgl.Marker(markerElement)
              .setLngLat(dest.coords)
              .setPopup(fallbackPopup)
              .addTo(map);
          }
        }
      }
      
      // Initialize markers with weather when page loads
      map.on('load', createMarkersWithWeather);
      
      // Remove the old marker creation code and replace with weather-enabled version
      // destinations.forEach(dest => { ... }); // This is replaced by createMarkersWithWeather()
      // Function to add destination to planner
      window.addToPlanner = function(destinationName) {
        // Store in localStorage for the planner page
        let savedDestinations = JSON.parse(localStorage.getItem('plannedDestinations') || '[]');
        if (!savedDestinations.includes(destinationName)) {
          savedDestinations.push(destinationName);
          localStorage.setItem('plannedDestinations', JSON.stringify(savedDestinations));
          alert(`${destinationName} added to your planner!`);
        } else {
          alert(`${destinationName} is already in your planner.`);
        }
      };      // Enhanced destination cards with weather data
      function populateDestinationCards() {
        const container = document.getElementById('destinationsContainer');
        
        // Show loading state
        container.innerHTML = `
          <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading destinations and weather...</span>
            </div>
            <p class="mt-2 text-muted">Fetching live weather data...</p>
          </div>
        `;
        
        // Wait for weather data to load, then populate cards
        setTimeout(() => {
          container.innerHTML = destinations.map((dest, index) => {
            const weatherInfo = markersWithWeather[index]?.weather;
            const weatherDisplay = weatherInfo ? 
              `<span class="badge" style="background-color: ${getTempColor(weatherInfo.temp)}">${Math.round(weatherInfo.temp)}¬∞C</span>` : 
              `<span class="badge bg-secondary">${dest.avgTemp}</span>`;
              
            return `
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <h5 class="card-title text-primary">${dest.name}</h5>
                      ${weatherDisplay}
                    </div>
                    ${weatherInfo ? `<p class="small text-muted mb-2">${getWeatherIcon(weatherInfo.conditions)} ${weatherInfo.conditions}</p>` : ''}
                    <p class="card-text text-muted small">${dest.description}</p>
                    
                    <div class="mb-2">
                      <small class="text-muted"><strong>Category:</strong> ${dest.category}</small><br>
                      <small class="text-muted"><strong>Best Time:</strong> ${dest.bestTime}</small>
                    </div>
                    
                    <div class="mb-3">
                      <small class="text-muted"><strong>Top Highlights:</strong></small>
                      <div class="mt-1">
                        ${dest.highlights.slice(0, 3).map(h => `<span class="badge bg-light text-dark me-1">${h}</span>`).join('')}
                      </div>
                    </div>
                  </div>
                  <div class="card-footer bg-transparent">
                    <div class="row">
                      <div class="col-6">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="focusOnMap(${dest.coords[0]}, ${dest.coords[1]})">
                          <i class="fas fa-map-marker-alt"></i> View on Map
                        </button>
                      </div>
                      <div class="col-6">
                        <button class="btn btn-primary btn-sm w-100" onclick="addToPlanner('${dest.name}')">
                          <i class="fas fa-plus"></i> Add to Plan
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }).join('');
        }, 3000); // Give time for weather data to load
      }

      // Function to focus map on specific destination
      window.focusOnMap = function(lng, lat) {
        map.flyTo({
          center: [lng, lat],
          zoom: 10,
          duration: 2000
        });
      };

      // Add mobile responsiveness improvements
      function handleMobileMap() {
        // Adjust map height and controls for mobile
        if (window.innerWidth <= 768) {
          document.getElementById('map').style.height = '300px';
          // Add touch gestures for mobile
          map.scrollZoom.disable();
          map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');
        } else {
          document.getElementById('map').style.height = '400px';
          map.scrollZoom.enable();
        }
      }
        // Apply mobile adjustments on load and resize
      window.addEventListener('load', handleMobileMap);
      window.addEventListener('resize', handleMobileMap);
      
      // Handle map resize events to update popup positioning
      map.on('resize', () => {
        // Close any open popups on resize to prevent positioning issues
        const popups = document.querySelectorAll('.mapboxgl-popup');
        popups.forEach(popup => {
          const closeButton = popup.querySelector('.mapboxgl-popup-close-button');
          if (closeButton) closeButton.click();
        });
      });
      
      // Populate cards when page loads
      document.addEventListener('DOMContentLoaded', populateDestinationCards);
    </script>
    <script src="../assets/js/main.js"></script>
</body>
</html>