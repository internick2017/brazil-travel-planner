<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brazilian Destinations - Brazil Travel Planner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-map-marked-alt me-2"></i>
                Brazil Travel Planner
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="destinations.html">Destinations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="planner.html">Planner</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1>Brazilian Destinations</h1>
                <p class="lead">Discover amazing places across Brazil</p>
                <!-- Mapbox Map Integration -->
                <div id="map" style="width: 100%; height: 400px; border-radius: 12px; margin-bottom: 2rem;"></div>
                <!-- End Mapbox Map -->                <!-- Placeholder for destination cards -->
                <div class="row" id="destinationsContainer">
                  <!-- Destination cards will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="bottom-nav d-lg-none">
        <a href="../index.html" class="bottom-nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="destinations.html" class="bottom-nav-item active">
            <i class="fas fa-map-marker-alt"></i>
            <span>Destinations</span>
        </a>
        <a href="planner.html" class="bottom-nav-item">
            <i class="fas fa-calendar"></i>
            <span>Planner</span>
        </a>
        <a href="about.html" class="bottom-nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <script src="../assets/js/modules/config.js"></script>
    <script src="../assets/js/modules/weather.js"></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoiaW50ZXJuaWNrMjAxNyIsImEiOiJjbWJ1Nnk2aWgwYnQ5MmxweDAwMTVlM20xIn0.-ACRXNq9akIVkBCzU2Gz-w';
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-47.9292, -15.7801], // Center on Brazil
        zoom: 3.5
      });
      map.addControl(new mapboxgl.NavigationControl());
      
      // Initialize Weather API
      const weatherAPI = new WeatherAPI();
      let markersWithWeather = [];
      
      // Function to get weather icon based on condition
      function getWeatherIcon(condition) {
        const icons = {
          'Clear': 'â˜€ï¸',
          'Sunny': 'â˜€ï¸', 
          'Rain': 'ðŸŒ§ï¸',
          'Cloudy': 'â˜ï¸',
          'Overcast': 'â˜ï¸',
          'Partially cloudy': 'â›…',
          'default': 'ðŸŒ¤ï¸'
        };
        return icons[condition] || icons.default;
      }
      
      // Function to get temperature color
      function getTempColor(temp) {
        if (temp >= 30) return '#FF6B6B'; // Hot - Red
        if (temp >= 25) return '#FFD93D'; // Warm - Yellow  
        if (temp >= 20) return '#6BCF7F'; // Mild - Green
        return '#74C0FC'; // Cool - Blue
      }
      
      // Enhanced destination data with travel information
      const destinations = [
        { 
          name: 'Rio de Janeiro', 
          coords: [-43.1729, -22.9068],
          description: 'Famous for Christ the Redeemer, Copacabana Beach, and vibrant culture',
          highlights: ['Christ the Redeemer', 'Copacabana Beach', 'Sugarloaf Mountain', 'Carnival'],
          bestTime: 'Dec-Mar (Summer)',
          avgTemp: '25Â°C',
          category: 'Beach & Culture'
        },
        { 
          name: 'SÃ£o Paulo', 
          coords: [-46.6333, -23.5505],
          description: 'Brazil\'s largest city with amazing food, art, and nightlife',
          highlights: ['Art Museums', 'Food Scene', 'Vila Madalena', 'Japanese District'],
          bestTime: 'Apr-Oct (Dry season)',
          avgTemp: '20Â°C',
          category: 'Urban & Culture'
        },
        { 
          name: 'BrasÃ­lia', 
          coords: [-47.9292, -15.7801],
          description: 'Modern capital with unique architecture and government buildings',
          highlights: ['Cathedral', 'National Congress', 'JK Bridge', 'City Park'],
          bestTime: 'May-Sep (Dry season)',
          avgTemp: '21Â°C',
          category: 'Architecture & Politics'
        },
        { 
          name: 'Salvador', 
          coords: [-38.5014, -12.9730],
          description: 'Historic colonial city with Afro-Brazilian culture and beautiful beaches',
          highlights: ['Pelourinho', 'Historic Center', 'Beaches', 'Capoeira'],
          bestTime: 'Dec-Mar (Summer)',
          avgTemp: '27Â°C',
          category: 'History & Beach'
        },
        { 
          name: 'Manaus', 
          coords: [-60.0258, -3.1190],
          description: 'Gateway to the Amazon rainforest with unique wildlife and river tours',
          highlights: ['Meeting of Waters', 'Amazon Tours', 'Opera House', 'Jungle Lodge'],
          bestTime: 'Jul-Nov (Dry season)',
          avgTemp: '28Â°C',
          category: 'Nature & Adventure'
        },
        { 
          name: 'FlorianÃ³polis', 
          coords: [-48.5482, -27.5969],
          description: 'Island paradise with 42 beaches and tech innovation hub',
          highlights: ['Joaquina Beach', 'Lagoa da ConceiÃ§Ã£o', 'Surfing', 'Sand Dunes'],
          bestTime: 'Dec-Mar (Summer)',
          avgTemp: '24Â°C',
          category: 'Beach & Technology'
        },
        { 
          name: 'Foz do IguaÃ§u', 
          coords: [-54.5854, -25.5163],
          description: 'Home to spectacular Iguazu Falls, one of the world\'s largest waterfalls',
          highlights: ['Iguazu Falls', 'Bird Park', 'Triple Border', 'Itaipu Dam'],
          bestTime: 'Mar-May, Sep-Nov',
          avgTemp: '21Â°C',
          category: 'Nature & Adventure'
        }
      ];

      // Create enhanced markers with detailed popups and weather overlay
      async function createMarkersWithWeather() {
        for (const dest of destinations) {
          try {
            // Fetch current weather for each destination
            const weatherData = await weatherAPI.getCurrentWeather(`${dest.name},Brazil`, 'metric');
            const currentWeather = weatherData.currentConditions;
            const temp = Math.round(currentWeather.temp);
            const condition = currentWeather.conditions;
            const icon = getWeatherIcon(condition);
            
            // Create custom marker with weather overlay
            const markerElement = document.createElement('div');
            markerElement.className = 'custom-marker-weather';
            markerElement.innerHTML = `
              <div style="position: relative;">
                <div style="
                  background-color: ${getTempColor(temp)};
                  width: 24px;
                  height: 24px;
                  border-radius: 50%;
                  border: 2px solid white;
                  cursor: pointer;
                  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 10px;
                  font-weight: bold;
                  color: white;
                ">
                  ${temp}Â°
                </div>
                <div style="
                  position: absolute;
                  top: -8px;
                  right: -8px;
                  font-size: 12px;
                  filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.5));
                ">
                  ${icon}
                </div>
              </div>
            `;

            // Enhanced popup content with live weather
            const popupContent = `
              <div style="max-width: 320px; font-family: Arial, sans-serif;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <h5 style="margin: 0; color: #007BFF; font-size: 16px;">${dest.name}</h5>
                  <div style="text-align: right;">
                    <div style="font-size: 18px;">${icon} ${temp}Â°C</div>
                    <div style="font-size: 11px; color: #666;">${condition}</div>
                  </div>
                </div>
                
                <p style="margin: 0 0 8px 0; font-size: 13px; color: #666;">${dest.description}</p>
                
                <div style="margin-bottom: 8px;">
                  <strong style="font-size: 12px; color: #333;">Category:</strong> 
                  <span style="background: #e9ecef; padding: 2px 6px; border-radius: 12px; font-size: 11px;">${dest.category}</span>
                </div>
                
                <div style="margin-bottom: 8px;">
                  <strong style="font-size: 12px; color: #333;">Weather Now:</strong> 
                  <span style="font-size: 12px;">${temp}Â°C, ${condition}</span><br>
                  <strong style="font-size: 12px; color: #333;">Best Time:</strong> 
                  <span style="font-size: 12px;">${dest.bestTime}</span>
                </div>
                
                <div style="margin-bottom: 10px;">
                  <strong style="font-size: 12px; color: #333;">Highlights:</strong>
                  <ul style="margin: 4px 0 0 0; padding-left: 16px; font-size: 11px; color: #555;">
                    ${dest.highlights.map(h => `<li>${h}</li>`).join('')}
                  </ul>
                </div>
                
                <button onclick="addToPlanner('${dest.name}')" 
                        style="background: #28a745; color: white; border: none; padding: 6px 12px; 
                               border-radius: 4px; font-size: 12px; cursor: pointer; width: 100%;">
                  Add to My Planner
                </button>
              </div>
            `;

            const marker = new mapboxgl.Marker(markerElement)
              .setLngLat(dest.coords)
              .setPopup(new mapboxgl.Popup({ 
                offset: 25,
                closeButton: true,
                closeOnClick: false 
              }).setHTML(popupContent))
              .addTo(map);
              
            markersWithWeather.push({marker, dest, weather: currentWeather});
            
          } catch (error) {
            console.warn(`Could not fetch weather for ${dest.name}:`, error);
            // Fallback to basic marker without weather
            const markerElement = document.createElement('div');
            markerElement.className = 'custom-marker';
            markerElement.style.cssText = `
              background-color: #007BFF;
              width: 20px;
              height: 20px;
              border-radius: 50%;
              border: 2px solid white;
              cursor: pointer;
              box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            `;

            const popupContent = `
              <div style="max-width: 300px; font-family: Arial, sans-serif;">
                <h5 style="margin: 0 0 8px 0; color: #007BFF; font-size: 16px;">${dest.name}</h5>
                <p style="margin: 0 0 8px 0; font-size: 13px; color: #666;">${dest.description}</p>
                
                <div style="margin-bottom: 8px;">
                  <strong style="font-size: 12px; color: #333;">Category:</strong> 
                  <span style="background: #e9ecef; padding: 2px 6px; border-radius: 12px; font-size: 11px;">${dest.category}</span>
                </div>
                
                <div style="margin-bottom: 8px;">
                  <strong style="font-size: 12px; color: #333;">Best Time:</strong> 
                  <span style="font-size: 12px;">${dest.bestTime}</span>
                </div>
                
                <div style="margin-bottom: 8px;">
                  <strong style="font-size: 12px; color: #333;">Avg Temp:</strong> 
                  <span style="font-size: 12px;">${dest.avgTemp}</span>
                </div>
                
                <div style="margin-bottom: 10px;">
                  <strong style="font-size: 12px; color: #333;">Highlights:</strong>
                  <ul style="margin: 4px 0 0 0; padding-left: 16px; font-size: 11px; color: #555;">
                    ${dest.highlights.map(h => `<li>${h}</li>`).join('')}
                  </ul>
                </div>
                
                <button onclick="addToPlanner('${dest.name}')" 
                        style="background: #28a745; color: white; border: none; padding: 6px 12px; 
                               border-radius: 4px; font-size: 12px; cursor: pointer; width: 100%;">
                  Add to My Planner
                </button>
              </div>
            `;

            const marker = new mapboxgl.Marker(markerElement)
              .setLngLat(dest.coords)
              .setPopup(new mapboxgl.Popup({ 
                offset: 25,
                closeButton: true,
                closeOnClick: false 
              }).setHTML(popupContent))
              .addTo(map);
          }
        }
      }
      
      // Initialize markers with weather when page loads
      map.on('load', createMarkersWithWeather);
      
      // Remove the old marker creation code and replace with weather-enabled version
      // destinations.forEach(dest => { ... }); // This is replaced by createMarkersWithWeather()
      // Function to add destination to planner
      window.addToPlanner = function(destinationName) {
        // Store in localStorage for the planner page
        let savedDestinations = JSON.parse(localStorage.getItem('plannedDestinations') || '[]');
        if (!savedDestinations.includes(destinationName)) {
          savedDestinations.push(destinationName);
          localStorage.setItem('plannedDestinations', JSON.stringify(savedDestinations));
          alert(`${destinationName} added to your planner!`);
        } else {
          alert(`${destinationName} is already in your planner.`);
        }
      };      // Enhanced destination cards with weather data
      function populateDestinationCards() {
        const container = document.getElementById('destinationsContainer');
        
        // Show loading state
        container.innerHTML = `
          <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading destinations and weather...</span>
            </div>
            <p class="mt-2 text-muted">Fetching live weather data...</p>
          </div>
        `;
        
        // Wait for weather data to load, then populate cards
        setTimeout(() => {
          container.innerHTML = destinations.map((dest, index) => {
            const weatherInfo = markersWithWeather[index]?.weather;
            const weatherDisplay = weatherInfo ? 
              `<span class="badge" style="background-color: ${getTempColor(weatherInfo.temp)}">${Math.round(weatherInfo.temp)}Â°C</span>` : 
              `<span class="badge bg-secondary">${dest.avgTemp}</span>`;
              
            return `
              <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <h5 class="card-title text-primary">${dest.name}</h5>
                      ${weatherDisplay}
                    </div>
                    ${weatherInfo ? `<p class="small text-muted mb-2">${getWeatherIcon(weatherInfo.conditions)} ${weatherInfo.conditions}</p>` : ''}
                    <p class="card-text text-muted small">${dest.description}</p>
                    
                    <div class="mb-2">
                      <small class="text-muted"><strong>Category:</strong> ${dest.category}</small><br>
                      <small class="text-muted"><strong>Best Time:</strong> ${dest.bestTime}</small>
                    </div>
                    
                    <div class="mb-3">
                      <small class="text-muted"><strong>Top Highlights:</strong></small>
                      <div class="mt-1">
                        ${dest.highlights.slice(0, 3).map(h => `<span class="badge bg-light text-dark me-1">${h}</span>`).join('')}
                      </div>
                    </div>
                  </div>
                  <div class="card-footer bg-transparent">
                    <div class="row">
                      <div class="col-6">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="focusOnMap(${dest.coords[0]}, ${dest.coords[1]})">
                          <i class="fas fa-map-marker-alt"></i> View on Map
                        </button>
                      </div>
                      <div class="col-6">
                        <button class="btn btn-primary btn-sm w-100" onclick="addToPlanner('${dest.name}')">
                          <i class="fas fa-plus"></i> Add to Plan
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }).join('');
        }, 3000); // Give time for weather data to load
      }

      // Function to focus map on specific destination
      window.focusOnMap = function(lng, lat) {
        map.flyTo({
          center: [lng, lat],
          zoom: 10,
          duration: 2000
        });
      };

      // Add mobile responsiveness improvements
      function handleMobileMap() {
        // Adjust map height and controls for mobile
        if (window.innerWidth <= 768) {
          document.getElementById('map').style.height = '300px';
          // Add touch gestures for mobile
          map.scrollZoom.disable();
          map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');
        } else {
          document.getElementById('map').style.height = '400px';
          map.scrollZoom.enable();
        }
      }
      
      // Apply mobile adjustments on load and resize
      window.addEventListener('load', handleMobileMap);
      window.addEventListener('resize', handleMobileMap);
      
      // Populate cards when page loads
      document.addEventListener('DOMContentLoaded', populateDestinationCards);
    </script>
    <script src="../assets/js/main.js"></script>
</body>
</html>